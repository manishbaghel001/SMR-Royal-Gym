<div class="progress-spinner" *ngIf="showLoader">
    <p-progressSpinner class="p-progress-spinner-circle" ariaLabel="loading" strokeWidth="3"
        animationDuration="1s"></p-progressSpinner>
</div>

<!-- <button (click)="openWhatsapp()">Send via WhatsApp</button> -->


<!-- Add New User Pop Up -->
<p-dialog header="Add Client" [modal]="true" [(visible)]="visible" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
    [style]="{ width: '55vw' }" [draggable]="false" [resizable]="false" [maximizable]="true">
    <form #userForm="ngForm" (ngSubmit)="addUser(userForm.value)">
        <div class="flex flex-wrap">
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="id" class="font-semibold w-6rem">ID No</label>
                <p-inputNumber [disabled]="editMode" placeholder="ID No" maxlength="10" [useGrouping]="false" id="id"
                    class="flex-auto" autocomplete="off" name="id" [(ngModel)]="userdata.id" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="name" class="font-semibold w-6rem">Name</label>
                <input pInputText [disabled]="editMode" placeholder="Name" type="text" id="name" class="flex-auto"
                    autocomplete="off" name="name" [(ngModel)]="userdata.name" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="phone" class="font-semibold w-6rem">Phone No.</label>
                <p-inputNumber [disabled]="editMode" placeholder="Phone No." maxlength="10" [min]="1000000000"
                    [useGrouping]="false" id="phone" class="flex-auto" autocomplete="off" name="phone"
                    [(ngModel)]="userdata.phone" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="aadhar" class="font-semibold w-9rem ">Aadhar Card No.</label>
                <p-inputNumber [disabled]="editMode" placeholder="Aadhar" maxlength="12" [min]="100000000000"
                    [useGrouping]="false" id="aadhar" class="flex-auto" autocomplete="off" name="aadhar"
                    [(ngModel)]="userdata.aadhar" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="address" class="font-semibold w-6rem">Address</label>
                <input pInputText [disabled]="editMode" placeholder="Address" type="text" id="address" class="flex-auto"
                    autocomplete="off" name="address" [(ngModel)]="userdata.address" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="doj" class="font-semibold w-9rem">Date Of Joining</label>
                <p-calendar [maxDate]="dateTime" [disabled]="editMode" [showIcon]="true" class="flex-auto" name="doj"
                    inputId="doj" [showOnFocus]="false" placeholder="Select Date of Joining" dateFormat="dd/mm/yy"
                    id="doj" autocomplete="off" [(ngModel)]="dojDate" [showButtonBar]="true" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="advance" class="font-semibold w-6rem">Advance</label>
                <p-inputNumber [disabled]="editMode" maxlength="6" mode="currency" inputId="currency-india"
                    currency="INR" [minFractionDigits]="0" placeholder="Advance" locale="en-IN" id="advance"
                    class="flex-auto" autocomplete="off" name="advance" [(ngModel)]="userdata.advance" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="fee" class="font-semibold w-6rem">Fee</label>
                <p-inputNumber maxlength="6" placeholder="Fee" mode="currency" inputId="currency-india"
                    [minFractionDigits]="0" currency="INR" locale="en-IN" id="fee" class="flex-auto" autocomplete="off"
                    name="fee" [(ngModel)]="userdata.fee" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="feedate" class="font-semibold w-6rem"> Fee Date </label>
                <p-calendar [maxDate]="dateTime" [showIcon]="true" placeholder="Select Fee Date" class="flex-auto"
                    name="feedate" inputId="feedate" [showOnFocus]="false" dateFormat="dd/mm/yy" id="feedate"
                    autocomplete="off" [(ngModel)]="feeDate" [showButtonBar]="true" required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="package" class="font-semibold w-6rem">Package</label>
                <p-dropdown [options]="packageId" class="flex-auto" id="package" autocomplete="off" name="package"
                    [(ngModel)]="userdata.package" optionLabel="name" [showClear]="true" placeholder="Select a Package"
                    required />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="aadhar" class="font-semibold w-9rem ">Height</label>
                <p-inputNumber [disabled]="editMode" maxlength="3" placeholder="Height" [useGrouping]="false"
                    id="height" class="flex-auto" autocomplete="off" suffix=" cm" name="height"
                    [(ngModel)]="userdata.height" />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="package" class="font-semibold w-6rem">Weight</label>
                <p-inputNumber [disabled]="editMode" maxlength="3" placeholder="Weight" [useGrouping]="false"
                    id="weight" class="flex-auto" autocomplete="off" suffix=" kg" name="weight"
                    [(ngModel)]="userdata.weight" />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="package" class="font-semibold w-6rem">Chest Size</label>
                <p-inputNumber [disabled]="editMode" maxlength="3" placeholder="Chest" [useGrouping]="false" id="chest"
                    class="flex-auto" autocomplete="off" suffix=" cm" name="chest" [(ngModel)]="userdata.chest" />
            </div>
            <div class="flex flex-column gap-3 mb-5 mr-4">
                <label for="package" class="font-semibold w-6rem">Biceps Size</label>
                <p-inputNumber [disabled]="editMode" maxlength="3" placeholder="Biceps" [useGrouping]="false"
                    id="biceps" suffix=" cm" class="flex-auto" autocomplete="off" name="biceps"
                    [(ngModel)]="userdata.biceps" />
            </div>
        </div>

        <div class="flex flex-column gap-3 mb-5">
            <label for="photo" class="font-semibold w-6rem">Photo</label>

            <div class="flex justify-content-start">
                <div *ngIf="removeImageHide" class="gap-3">
                    <p-image class="flex" [src]="userdata.photo" [alt]="userdata.name" width="100" [preview]="true"
                        class="shadow-4" />
                    <p-button [disabled]="editMode" label="Change Image" class="ml-5" (click)="removeFile()"></p-button>
                </div>
                <p-fileUpload #fileUpload name="demo[]" *ngIf="!removeImageHide" fileLimit="1"
                    [showUploadButton]="false" (onSelect)="onFileSelect($event, fileUpload)" chooseLabel="Choose"
                    chooseIcon="pi pi-upload" [auto]="false" accept="image/*" maxFileSize="20000000" required>
                    <ng-template pTemplate="content">
                    </ng-template>
                </p-fileUpload>
            </div>
        </div>

        <p-panel *ngIf="editMode" header="Transactions Table" [toggleable]="true" [collapsed]="true">
            <p-table [value]="userdata['transaction']" [tableStyle]="{ 'min-width': '50rem' }">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Transaction Date</th>
                        <th>Fee Date</th>
                        <th>Package</th>
                        <th>Amount</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-product>
                    <tr>
                        <td>{{ product.date }}</td>
                        <td>{{ product.feedate }}</td>
                        <td>{{ product.package }}</td>
                        <td>{{ product.fee }}</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-panel>

        <div class="flex justify-content-end gap-3 mt-5">
            <p-button label="Cancel" severity="secondary" (click)="cancel()" />
            <p-button *ngIf="updateBtnHdn" label="Save" type="submit" />
            <p-button *ngIf="!updateBtnHdn" label="Update" type="submit" />
        </div>
    </form>
</p-dialog>

<div class="m-4 mb-0 pb-4">

    <!-- New User -->
    <div class="flex justify-content-end gap-3 mb-4">
        <p-button *ngIf="!userTableHdn" (click)="allUser()" severity="info" [raised]="true" label="All Clients" />
        <p-button *ngIf="userTableHdn" (click)="feePendindUser()" severity="danger" [raised]="true"
            label="Pending Fee Clients" />
        <p-button (click)="newUser()" severity="success" [raised]="true" label="Add New Client" />
    </div>

    <!-- User Table -->
    <p-card styleClass="p-card-shadow">
        <p-table #dt class="-mt-6" sortField="id" [sortOrder]="-1" [value]="users" dataKey="id" [paginator]="true"
            [rows]="5" [rowHover]="true" [rowsPerPageOptions]="[5, 10, 20]" [tableStyle]="{ 'min-width': '50rem' }"
            [first]="first" [loading]="loading" [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
            [globalFilterFields]="['id','name','phone','aadhar']" [(selection)]="selectedProducts"
            [exportHeader]="'customExportHeader'" [columns]="cols">
            <ng-template pTemplate="caption">
                <div class="flex align-items-center justify-content-between -mt-5">
                    <!-- <button type="button" pButton pRipple icon="pi pi-file" (click)="dt.exportCSV()" class="mr-2"
                        pTooltip="CSV" tooltipPosition="bottom"></button>
                    <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()"
                        class="p-button-success mr-2" pTooltip="XLS" tooltipPosition="bottom"></button> -->
                    <button type="button" pButton [rounded]="true" [text]="true" severity="warning" size="large" pRipple
                        icon="pi pi-file-pdf" (click)="exportPdf()" class="p-button-warning mr-2" pTooltip="PDF"
                        tooltipPosition="bottom"></button>
                    <span *ngIf="userTableHdn"> List of Clients </span>
                    <span *ngIf="!userTableHdn"> Pending Fee Clients </span>
                    <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="dt.filterGlobal($event.target['value'], 'contains')"
                            placeholder="Global Search" />
                    </span>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="id" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            ID No
                            <p-sortIcon field="id"></p-sortIcon>
                            <p-columnFilter type="text" field="id" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th pSortableColumn="name" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Name
                            <p-sortIcon field="name"></p-sortIcon>
                            <p-columnFilter type="text" field="name" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th pSortableColumn="phone" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Phone Number
                            <p-sortIcon field="phone"></p-sortIcon>
                            <p-columnFilter type="text" field="phone" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="!userTableHdn" pSortableColumn="feedate" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Fee Date
                            <p-sortIcon field="feedate"></p-sortIcon>
                            <p-columnFilter type="text" field="feedate" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="!userTableHdn" pSortableColumn="package" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Package
                            <p-sortIcon field="package"></p-sortIcon>
                            <p-columnFilter type="text" field="package" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="userTableHdn" pSortableColumn="aadhar" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Aadhar Card
                            <p-sortIcon field="aadhar"></p-sortIcon>
                            <p-columnFilter type="text" field="aadhar" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="userTableHdn" pSortableColumn="address" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Address
                            <p-sortIcon field="address"></p-sortIcon>
                            <p-columnFilter type="text" field="address" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="userTableHdn" pSortableColumn="doj" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Date of Joining
                            <p-sortIcon field="doj"></p-sortIcon>
                            <p-columnFilter type="text" field="doj" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="userTableHdn" pSortableColumn="advance" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Advance
                            <p-sortIcon field="advance"></p-sortIcon>
                            <p-columnFilter type="text" field="advance" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th *ngIf="userTableHdn" pSortableColumn="fee" style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Fee
                            <p-sortIcon field="fee"></p-sortIcon>
                            <p-columnFilter type="text" field="fee" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Photo
                        </div>
                    </th>
                    <th style="min-width: auto">
                        <div class="flex justify-content-between align-items-center">
                            Action
                        </div>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product let-editing="editing">
                <tr>
                    <td>
                        {{ product.id }}
                    </td>
                    <td>
                        {{ product.name }}
                    </td>
                    <td>
                        {{ product.phone }}
                    </td>
                    <td *ngIf="!userTableHdn">
                        {{ product.feedate }}
                    </td>
                    <td *ngIf="!userTableHdn">
                        {{ product.package }}
                    </td>
                    <td *ngIf="userTableHdn">
                        {{ product.aadhar }}
                    </td>
                    <td *ngIf="userTableHdn">
                        {{ product.address }}
                    </td>
                    <td *ngIf="userTableHdn">
                        {{ product.doj }}
                    </td>
                    <td *ngIf="userTableHdn">
                        {{ product.advance | currency : 'INR' }}
                    </td>
                    <td *ngIf="userTableHdn">
                        {{ product.fee | currency : 'INR' }}
                    </td>
                    <td>
                        <p-image [src]="product.photo" [alt]="product.name" width="100" height="100" [preview]="true"
                            class="shadow-4" />
                    </td>
                    <td>
                        <div class="flex align-items-center justify-content-between">
                            <p-button size="large" icon="pi pi-user-edit" [text]="true" [raised]="true" severity="info"
                                (click)="edit(product)" />
                            <p-button *ngIf="userTableHdn" size="large" icon="pi pi-trash" [text]="true" [raised]="true"
                                severity="danger" (click)="delete($event, product.uid)" />
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="8">
                        <div class="flex justify-content-center align-items-center">
                            No clients found.
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>
    <!-- Fee Table -->
    <!-- <p-card *ngIf="!userTableHdn" styleClass="p-card-shadow">
        <p-table #dtFee [value]="pendingFeeUsers" dataKey="id" [rowHover]="true" [paginator]="true" [rows]="5"
            [rowsPerPageOptions]="[5, 10, 20]" [tableStyle]="{ 'min-width': '50rem' }" [first]="first"
            [showCurrentPageReport]="true" [loading]="loading"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" class="p-element"
            [filterDelay]="0" [globalFilterFields]="['id','name','phone','feedate', 'package']">
            <ng-template pTemplate="caption">
                <div class="flex align-items-center justify-content-between -mt-5">
                    Pending Fee Clients
                    <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="dtFee.filterGlobal($event.target['value'], 'contains')"
                            placeholder="Global Search" />
                    </span>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="id" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Id No
                            <p-sortIcon field="id"></p-sortIcon>
                            <p-columnFilter type="text" field="id" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th pSortableColumn="name" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Name
                            <p-sortIcon field="name"></p-sortIcon>
                            <p-columnFilter type="text" field="name" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th pSortableColumn="phone" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Phone Number
                            <p-sortIcon field="phone"></p-sortIcon>
                            <p-columnFilter type="text" field="phone" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th pSortableColumn="feedate" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Fee Date
                            <p-sortIcon field="feedate"></p-sortIcon>
                            <p-columnFilter type="text" field="feedate" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th pSortableColumn="package" style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Package
                            <p-sortIcon field="package"></p-sortIcon>
                            <p-columnFilter type="text" field="package" display="menu" class="ml-auto"></p-columnFilter>
                        </div>
                    </th>
                    <th style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Photo
                        </div>
                    </th>
                    <th style="min-width: 14rem">
                        <div class="flex justify-content-between align-items-center">
                            Action
                        </div>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product let-editing="editing">
                <tr>
                    <td>
                        {{ product.id }}
                    </td>
                    <td>
                        {{ product.name }}
                    </td>
                    <td>
                        {{ product.phone }}
                    </td>
                    <td>
                        {{ product.feedate }}
                    </td>
                    <td>
                        {{ product.package }}
                    </td>
                    <td>
                        <p-image [src]="getUniqueImageUrl(product.uid)" [alt]="product.name" width="100"
                            [preview]="true" class="shadow-4" />
                    </td>
                    <td>
                        <div class="flex align-items-center justify-content-between">
                            <p-button size="large" icon="pi pi-user-edit" [text]="true" [raised]="true" severity="info"
                                (click)="edit(product, true)" />
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="8">
                        <div class="flex justify-content-center align-items-center">
                            No clients found.
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card> -->
</div>